// Country name to flag emoji mapping
const COUNTRY_FLAGS = {
  "Afghanistan": "ðŸ‡¦ðŸ‡«",
  "Albania": "ðŸ‡¦ðŸ‡±",
  "Algeria": "ðŸ‡©ðŸ‡¿",
  "American Samoa": "ðŸ‡¦ðŸ‡¸",
  "Andorra": "ðŸ‡¦ðŸ‡©",
  "Angola": "ðŸ‡¦ðŸ‡´",
  "Anguilla": "ðŸ‡¦ðŸ‡®",
  "Antarctica": "ðŸ‡¦ðŸ‡¶",
  "Antigua and Barbuda": "ðŸ‡¦ðŸ‡¬",
  "Argentina": "ðŸ‡¦ðŸ‡·",
  "Armenia": "ðŸ‡¦ðŸ‡²",
  "Aruba": "ðŸ‡¦ðŸ‡¼",
  "Australia": "ðŸ‡¦ðŸ‡º",
  "Austria": "ðŸ‡¦ðŸ‡¹",
  "Azerbaijan": "ðŸ‡¦ðŸ‡¿",
  "Bahamas": "ðŸ‡§ðŸ‡¸",
  "Bahrain": "ðŸ‡§ðŸ‡­",
  "Bangladesh": "ðŸ‡§ðŸ‡©",
  "Barbados": "ðŸ‡§ðŸ‡§",
  "Belarus": "ðŸ‡§ðŸ‡¾",
  "Belgium": "ðŸ‡§ðŸ‡ª",
  "Belize": "ðŸ‡§ðŸ‡¿",
  "Benin": "ðŸ‡§ðŸ‡¯",
  "Bermuda": "ðŸ‡§ðŸ‡²",
  "Bhutan": "ðŸ‡§ðŸ‡¹",
  "Bolivia": "ðŸ‡§ðŸ‡´",
  "Bosnia and Herzegovina": "ðŸ‡§ðŸ‡¦",
  "Botswana": "ðŸ‡§ðŸ‡¼",
  "Bouvet Island": "ðŸ‡§ðŸ‡»",
  "Brazil": "ðŸ‡§ðŸ‡·",
  "British Indian Ocean Territory": "ðŸ‡®ðŸ‡´",
  "Brunei Darussalam": "ðŸ‡§ðŸ‡³",
  "Bulgaria": "ðŸ‡§ðŸ‡¬",
  "Burkina Faso": "ðŸ‡§ðŸ‡«",
  "Burundi": "ðŸ‡§ðŸ‡®",
  "Cambodia": "ðŸ‡°ðŸ‡­",
  "Cameroon": "ðŸ‡¨ðŸ‡²",
  "Canada": "ðŸ‡¨ðŸ‡¦",
  "Cape Verde": "ðŸ‡¨ðŸ‡»",
  "Cayman Islands": "ðŸ‡°ðŸ‡¾",
  "Central African Republic": "ðŸ‡¨ðŸ‡«",
  "Chad": "ðŸ‡¹ðŸ‡©",
  "Chile": "ðŸ‡¨ðŸ‡±",
  "China": "ðŸ‡¨ðŸ‡³",
  "Christmas Island": "ðŸ‡¨ðŸ‡½",
  "Cocos (Keeling) Islands": "ðŸ‡¨ðŸ‡¨",
  "Colombia": "ðŸ‡¨ðŸ‡´",
  "Comoros": "ðŸ‡°ðŸ‡²",
  "Congo": "ðŸ‡¨ðŸ‡¬",
  "Congo, The Democratic Republic of the": "ðŸ‡¨ðŸ‡©",
  "Cook Islands": "ðŸ‡¨ðŸ‡°",
  "Costa Rica": "ðŸ‡¨ðŸ‡·",
  "Cote D'Ivoire": "ðŸ‡¨ðŸ‡®",
  "Croatia": "ðŸ‡­ðŸ‡·",
  "Cuba": "ðŸ‡¨ðŸ‡º",
  "Cyprus": "ðŸ‡¨ðŸ‡¾",
  "Czech Republic": "ðŸ‡¨ðŸ‡¿",
  "Denmark": "ðŸ‡©ðŸ‡°",
  "Djibouti": "ðŸ‡©ðŸ‡¯",
  "Dominica": "ðŸ‡©ðŸ‡²",
  "Dominican Republic": "ðŸ‡©ðŸ‡´",
  "Ecuador": "ðŸ‡ªðŸ‡¨",
  "Egypt": "ðŸ‡ªðŸ‡¬",
  "El Salvador": "ðŸ‡¸ðŸ‡»",
  "Equatorial Guinea": "ðŸ‡¬ðŸ‡¶",
  "Eritrea": "ðŸ‡ªðŸ‡·",
  "Estonia": "ðŸ‡ªðŸ‡ª",
  "Ethiopia": "ðŸ‡ªðŸ‡¹",
  "Europe": "ðŸ‡ªðŸ‡º",
  "European Union": "ðŸ‡ªðŸ‡º",
  "Falkland Islands (Malvinas)": "ðŸ‡«ðŸ‡°",
  "Faroe Islands": "ðŸ‡«ðŸ‡´",
  "Fiji": "ðŸ‡«ðŸ‡¯",
  "Finland": "ðŸ‡«ðŸ‡®",
  "France": "ðŸ‡«ðŸ‡·",
  "French Guiana": "ðŸ‡¬ðŸ‡«",
  "French Polynesia": "ðŸ‡µðŸ‡«",
  "French Southern Territories": "ðŸ‡¹4",
  "Gabon": "ðŸ‡¬ðŸ‡¦",
  "Gambia": "ðŸ‡¬ðŸ‡²",
  "Georgia": "ðŸ‡¬ðŸ‡ª",
  "Germany": "ðŸ‡©ðŸ‡ª",
  "Ghana": "ðŸ‡¬ðŸ‡­",
  "Gibraltar": "ðŸ‡¬ðŸ‡®",
  "Greece": "ðŸ‡¬ðŸ‡·",
  "Greenland": "ðŸ‡¬ðŸ‡±",
  "Grenada": "ðŸ‡¬ðŸ‡©",
  "Guadeloupe": "ðŸ‡¬ðŸ‡µ",
  "Guam": "ðŸ‡¬ðŸ‡º",
  "Guatemala": "ðŸ‡¬ðŸ‡¹",
  "Guinea": "ðŸ‡¬ðŸ‡³",
  "Guinea-Bissau": "ðŸ‡¬ðŸ‡¼",
  "Guyana": "ðŸ‡¬ðŸ‡¾",
  "Haiti": "ðŸ‡­ðŸ‡¹",
  "Heard Island and Mcdonald Islands": "ðŸ‡­ðŸ‡²",
  "Holy See (Vatican City State)": "ðŸ‡»ðŸ‡¦",
  "Honduras": "ðŸ‡­ðŸ‡³",
  "Hong Kong": "ðŸ‡­ðŸ‡°",
  "Hungary": "ðŸ‡­ðŸ‡º",
  "Iceland": "ðŸ‡®ðŸ‡¸",
  "India": "ðŸ‡®ðŸ‡³",
  "Indonesia": "ðŸ‡®ðŸ‡©",
  "Iran": "ðŸ‡®ðŸ‡·",
  "Iraq": "ðŸ‡®ðŸ‡¶",
  "Ireland": "ðŸ‡®ðŸ‡ª",
  "Israel": "ðŸ‡®ðŸ‡±",
  "Italy": "ðŸ‡®ðŸ‡¹",
  "Jamaica": "ðŸ‡¯ðŸ‡²",
  "Japan": "ðŸ‡¯ðŸ‡µ",
  "Jordan": "ðŸ‡¯ðŸ‡´",
  "Kazakhstan": "ðŸ‡°ðŸ‡¿",
  "Kenya": "ðŸ‡°ðŸ‡ª",
  "Kiribati": "ðŸ‡°ðŸ‡®",
  "Korea": "ðŸ‡°ðŸ‡·",
  "North Korea": "ðŸ‡°ðŸ‡µ",
  "South Korea": "ðŸ‡°ðŸ‡·",
  "Kuwait": "ðŸ‡°ðŸ‡¼",
  "Kyrgyzstan": "ðŸ‡°ðŸ‡¬",
  "Lao People's Democratic Republic": "ðŸ‡±ðŸ‡¦",
  "Latvia": "ðŸ‡±ðŸ‡»",
  "Lebanon": "ðŸ‡±ðŸ‡§",
  "Lesotho": "ðŸ‡±ðŸ‡¸",
  "Liberia": "ðŸ‡±ðŸ‡·",
  "Libyan Arab Jamahiriya": "ðŸ‡±ðŸ‡¾",
  "Liechtenstein": "ðŸ‡±ðŸ‡®",
  "Lithuania": "ðŸ‡±ðŸ‡¹",
  "Luxembourg": "ðŸ‡±ðŸ‡º",
  "Macao": "ðŸ‡²ðŸ‡´",
  "Macedonia": "ðŸ‡²ðŸ‡°",
  "Madagascar": "ðŸ‡²ðŸ‡¬",
  "Malawi": "ðŸ‡²ðŸ‡¼",
  "Malaysia": "ðŸ‡²ðŸ‡¾",
  "Maldives": "ðŸ‡²ðŸ‡»",
  "Mali": "ðŸ‡²ðŸ‡±",
  "Malta": "ðŸ‡²ðŸ‡¹",
  "Marshall Islands": "ðŸ‡²ðŸ‡­",
  "Martinique": "ðŸ‡²ðŸ‡¶",
  "Mauritania": "ðŸ‡²ðŸ‡·",
  "Mauritius": "ðŸ‡²ðŸ‡º",
  "Mayotte": "ðŸ‡¾ðŸ‡¹",
  "Mexico": "ðŸ‡²ðŸ‡½",
  "Micronesia": "ðŸ‡«ðŸ‡²",
  "Moldova": "ðŸ‡²ðŸ‡©",
  "Monaco": "ðŸ‡²ðŸ‡¨",
  "Mongolia": "ðŸ‡²ðŸ‡³",
  "Montserrat": "ðŸ‡²ðŸ‡¸",
  "Morocco": "ðŸ‡²ðŸ‡¦",
  "Mozambique": "ðŸ‡²ðŸ‡¿",
  "Myanmar": "ðŸ‡²ðŸ‡²",
  "Namibia": "ðŸ‡³ðŸ‡¦",
  "Nauru": "ðŸ‡³ðŸ‡·",
  "Nepal": "ðŸ‡³ðŸ‡µ",
  "Netherlands": "ðŸ‡³ðŸ‡±",
  "Netherlands Antilles": "ðŸ‡¦ðŸ‡³",
  "New Caledonia": "ðŸ‡³ðŸ‡¨",
  "New Zealand": "ðŸ‡³ðŸ‡¿",
  "Nicaragua": "ðŸ‡³ðŸ‡®",
  "Niger": "ðŸ‡³ðŸ‡ª",
  "Nigeria": "ðŸ‡³ðŸ‡¬",
  "Niue": "ðŸ‡³ðŸ‡º",
  "Norfolk Island": "ðŸ‡³ðŸ‡«",
  "Northern Mariana Islands": "ðŸ‡²ðŸ‡µ",
  "Norway": "ðŸ‡³ðŸ‡´",
  "Oman": "ðŸ‡´ðŸ‡²",
  "Pakistan": "ðŸ‡µðŸ‡°",
  "Palau": "ðŸ‡µðŸ‡¼",
  "Palestinian Territory": "ðŸ‡µðŸ‡¸",
  "Panama": "ðŸ‡µðŸ‡¦",
  "Papua New Guinea": "ðŸ‡µðŸ‡¬",
  "Paraguay": "ðŸ‡µðŸ‡¾",
  "Peru": "ðŸ‡µðŸ‡ª",
  "Philippines": "ðŸ‡µðŸ‡­",
  "Pitcairn": "ðŸ‡µðŸ‡³",
  "Poland": "ðŸ‡µðŸ‡±",
  "Portugal": "ðŸ‡µðŸ‡¹",
  "Puerto Rico": "ðŸ‡µðŸ‡·",
  "Qatar": "ðŸ‡¶ðŸ‡¦",
  "Reunion": "ðŸ‡·ðŸ‡ª",
  "Romania": "ðŸ‡·ðŸ‡´",
  "Russia": "ðŸ‡·ðŸ‡º",
  "Russian Federation": "ðŸ‡·ðŸ‡º",
  "Rwanda": "ðŸ‡·ðŸ‡¼",
  "Saint Helena": "ðŸ‡¸ðŸ‡­",
  "Saint Kitts and Nevis": "ðŸ‡°ðŸ‡³",
  "Saint Lucia": "ðŸ‡±ðŸ‡¨",
  "Saint Pierre and Miquelon": "ðŸ‡µðŸ‡²",
  "Saint Vincent and the Grenadines": "ðŸ‡»ðŸ‡¨",
  "Samoa": "ðŸ‡¼ðŸ‡¸",
  "San Marino": "ðŸ‡¸ðŸ‡²",
  "Sao Tome and Principe": "ðŸ‡¸ðŸ‡¹",
  "Saudi Arabia": "ðŸ‡¸ðŸ‡¦",
  "Senegal": "ðŸ‡¸ðŸ‡³",
  "Serbia and Montenegro": "ðŸ‡·ðŸ‡¸",
  "Seychelles": "ðŸ‡¸ðŸ‡¨",
  "Sierra Leone": "ðŸ‡¸ðŸ‡±",
  "Singapore": "ðŸ‡¸ðŸ‡¬",
  "Slovakia": "ðŸ‡¸ðŸ‡°",
  "Slovenia": "ðŸ‡¸ðŸ‡®",
  "Solomon Islands": "ðŸ‡¸ðŸ‡§",
  "Somalia": "ðŸ‡¸ðŸ‡´",
  "South Africa": "ðŸ‡¿ðŸ‡¦",
  "South Georgia and the South Sandwich Islands": "ðŸ‡¬ðŸ‡¸",
  "Spain": "ðŸ‡ªðŸ‡¸",
  "Sri Lanka": "ðŸ‡±ðŸ‡°",
  "Sudan": "ðŸ‡¸ðŸ‡©",
  "Suriname": "ðŸ‡¸ðŸ‡·",
  "Svalbard and Jan Mayen": "ðŸ‡¸ðŸ‡¯",
  "Swaziland": "ðŸ‡¸ðŸ‡¿",
  "Sweden": "ðŸ‡¸ðŸ‡ª",
  "Switzerland": "ðŸ‡¨ðŸ‡­",
  "Syrian Arab Republic": "ðŸ‡¸ðŸ‡¾",
  "Taiwan": "ðŸ‡¹ðŸ‡¼",
  "Tajikistan": "ðŸ‡¹ðŸ‡¯",
  "Tanzania": "ðŸ‡¹ðŸ‡¿",
  "Thailand": "ðŸ‡¹ðŸ‡­",
  "Timor-Leste": "ðŸ‡¹ðŸ‡±",
  "Togo": "ðŸ‡¹ðŸ‡¬",
  "Tokelau": "ðŸ‡¹ðŸ‡°",
  "Tonga": "ðŸ‡¹ðŸ‡´",
  "Trinidad and Tobago": "ðŸ‡¹ðŸ‡¹",
  "Tunisia": "ðŸ‡¹ðŸ‡³",
  "Turkey": "ðŸ‡¹ðŸ‡·",
  "Turkmenistan": "ðŸ‡¹ðŸ‡²",
  "Turks and Caicos Islands": "ðŸ‡¹ðŸ‡¨",
  "Tuvalu": "ðŸ‡¹ðŸ‡»",
  "Uganda": "ðŸ‡ºðŸ‡¬",
  "Ukraine": "ðŸ‡ºðŸ‡¦",
  "United Arab Emirates": "ðŸ‡¦ðŸ‡ª",
  "United Kingdom": "ðŸ‡¬ðŸ‡§",
  "United States": "ðŸ‡ºðŸ‡¸",
  "United States Minor Outlying Islands": "ðŸ‡ºðŸ‡²",
  "Uruguay": "ðŸ‡ºðŸ‡¾",
  "Uzbekistan": "ðŸ‡ºðŸ‡¿",
  "Vanuatu": "ðŸ‡»ðŸ‡º",
  "Venezuela": "ðŸ‡»ðŸ‡ª",
  "Vietnam": "ðŸ‡»ðŸ‡³",
  "Virgin Islands, British": "ðŸ‡»ðŸ‡¬",
  "Virgin Islands, U.S.": "ðŸ‡»6",
  "Wallis and Futuna": "ðŸ‡¼ðŸ‡«",
  "Western Sahara": "ðŸ‡ªðŸ‡­",
  "Yemen": "ðŸ‡¾ðŸ‡ª",
  "Zambia": "ðŸ‡¿ðŸ‡²",
  "Zimbabwe": "ðŸ‡¿ðŸ‡¼",

  // Regions & Continents
  "North America": "ðŸŒŽ",
  "South America": "ðŸŒŽ",
  "Central America": "ðŸŒŽ",
  "Latin America": "ðŸŒŽ",
  "Latin America and the Caribbean": "ðŸŒŽ",
  "Latin America & Caribbean": "ðŸŒŽ",
  "Europe & Central Asia": "ðŸŒ",
  "Middle East": "ðŸŒ",
  "Middle East & North Africa": "ðŸŒ",
  "Africa": "ðŸŒ",
  "Sub-Saharan Africa": "ðŸŒ",
  "Asia": "ðŸŒ",
  "East Asia": "ðŸŒ",
  "East Asia & Pacific": "ðŸŒ",
  "South Asia": "ðŸŒ",
  "Southeast Asia": "ðŸŒ",
  "Asia-Pacific": "ðŸŒ",
  "Oceania": "ðŸŒ",
  "Antarctica": "ðŸ‡¦ðŸ‡¶",
  "World": "ðŸŒ",
  "Global": "ðŸŒ",
  "International": "ðŸŒ"
};

function getCountryFlag(countryName) {
  if (!countryName) return null;
  
  // 1. Try exact match first
  if (COUNTRY_FLAGS[countryName]) {
    return COUNTRY_FLAGS[countryName];
  }
  
  // 2. Try case-insensitive match
  const normalized = countryName.trim();
  const normalizedLower = normalized.toLowerCase();
  
  for (const [country, flag] of Object.entries(COUNTRY_FLAGS)) {
    if (country.toLowerCase() === normalizedLower) {
      return flag;
    }
  }
  
  // 3. Try to find country INSIDE the location string (e.g. "Paris, France" -> "France")
  // Sort countries by length (descending) so "South Africa" matches before "Africa"
  const sortedCountries = Object.keys(COUNTRY_FLAGS).sort((a, b) => b.length - a.length);
  
  for (const country of sortedCountries) {
    if (normalizedLower.includes(country.toLowerCase())) {
      // Avoid false positives where a country name is part of a word (e.g. "Mali" in "Malibu")
      // Simple boundary check
      const regex = new RegExp(`(^|\\s|,)` + country.replace(/[-\/\\^$*+?.()|[\]{}]/g, '\\$&') + `($|\\s|,)`, 'i');
      if (regex.test(normalized)) {
        return COUNTRY_FLAGS[country];
      }
    }
  }
  
  return null;
}